let app;function App(){this.currentWindowId=null,this.windowCounter=0,this.listOfTabs=[]}window.addEventListener("DOMContentLoaded",function(){(app=new App).init()}),window.addEventListener("unload",function(){app.unregisterAndCleanUp()}),App.prototype.getTabsList=function(){return new Promise((t,e)=>{chrome.windows.getAll({populate:!0},e=>{this.listOfTabs=[...e],t()})})},App.prototype.displayList=function({tabsList:t}){const e=document.querySelector(".tab-list");t.forEach((n,o)=>{const i=document.createDocumentFragment();if(n.tabs.forEach(t=>{i.appendChild(this.buildTabRow({tab:t}))}),t.length>1&&n.tabs.length>0){const t=this.buildGroup({chromeWindow:n,tabRowFragment:i,windowIndex:o+1});e.appendChild(t)}else e.appendChild(i)})},App.prototype.buildGroup=function({chromeWindow:t,tabRowFragment:e,windowIndex:n}){const o=document.createElement("div");o.className=`group ${t.incognito?"incognito":""}`;const i=document.createElement("div");if(i.className="group-title",currentWindowId=t.tabs.length>0?t.tabs[0].windowId:n,i.innerHTML=`window ${n}`,t.incognito){const t=document.createElement("img");t.src="../images/incognito.png",t.style.width="32px",t.className="incognito-image",i.appendChild(t)}return o.dataset.groupId=currentWindowId,t.tabs.length>0&&o.appendChild(i),o.appendChild(e),o},App.prototype.buildTabRow=function({tab:t}){const e=t.active?"active":"",n=t.audible?"":"hidden";let o="display: none",i="display:none";t.audible&&(o=t.mutedInfo.muted?"display:none":"display:block",i=t.mutedInfo.muted?"display:block":"display:none");const a=document.createElement("div");a.className=`tab-row ${e}`,a.dataset.tabId=t.id,a.dataset.windowId=t.windowId;const s=document.createElement("div");s.className="favicon";const d=document.createElement("img");d.src=t.favIconUrl,s.appendChild(d),a.appendChild(s);const c=document.createElement("div");c.className="tab-title";const r=document.createElement("span");r.className=`speaker ${n}`;const p=document.createElement("img");p.src="../images/icons8-Speaker-16.png",p.alt="tab is playing",p.dataset.type="speaker",p.style=o,r.append(p);const l=document.createElement("img");l.src="../images/icons8-No Audio-16.png",l.alt="tab is muted",l.dataset.type="speaker",l.style=i,r.append(p),r.append(l),c.appendChild(r);const u=document.createElement("span");u.className="tab-desc",u.innerText=t.title,c.appendChild(u),a.appendChild(c);const m=document.createElement("div");m.className="close-button",m.dataset.type="closeButton";const b=document.createElement("img");return b.src="./images/svg/times-circle.svg",b.dataset.type="closeButton",m.appendChild(b),a.appendChild(m),a},App.prototype.clearFilter=function(){document.querySelector(".filterBox").value="",document.querySelector(".tab-list").innerHTML="",this.displayList({tabsList:this.listOfTabs})},App.prototype.registerEvents=function(){document.querySelector(".tab-list").addEventListener("click",this.onTabListClick.bind(app)),document.querySelector(".tab-list").addEventListener("mousedown",this.onMouseDown.bind(app)),document.querySelector(".filterBox").addEventListener("keyup",this.filterTabs.bind(app)),document.querySelector(".remove-filter").addEventListener("click",this.clearFilter.bind(app))},App.prototype.onMouseDown=function(t){if(2===t.which){const{tabId:e,windowId:n}=this.getTabData(t);this.removeTabFromList(e),this.closeTab(e)}},App.prototype.onTabListClick=function(t){const{tabId:e,windowId:n}=this.getTabData(t),o=t.target.tagName.toLowerCase(),i=t.target.dataset.type;"img"!==o||"speaker"!==i?"img"!==o&&"div"!==o||"closeButton"!==i?this.setActiveTab({tabId:e,windowId:n}):(this.removeTabFromList(e),this.closeTab(e)):this.toggleMute(e)},App.prototype.toggleMute=function(t){chrome.tabs.get(t,e=>{const n=!e.mutedInfo.muted;chrome.tabs.update(t,{muted:n}),this.toggleMuteIcon(t,n)})},App.prototype.setActiveTab=function({tabId:t,windowId:e}){chrome.windows.update(e,{focused:!0},function(){this.selectedWindowId=e}),chrome.tabs.update(t,{active:!0})},App.prototype.unregisterAndCleanUp=function(){document.querySelector(".tab-list").removeEventListener("click",this.onTabListClick),document.querySelector(".filterBox").removeEventListener("keyup",this.filterTabs),document.querySelector(".remove-filter").removeEventListener("click",this.clearFilter)},App.prototype.getTabData=function(t){let e=t.target,n=e.tagName.toLowerCase();for(;"div"!==n||"div"===n&&!e.classList.contains("tab-row");)n=(e=e.parentNode).tagName.toLowerCase();return{tabId:parseInt(e.dataset.tabId),windowId:parseInt(e.dataset.windowId)}},App.prototype.closeTab=function(t){chrome.tabs.remove(t)},App.prototype.removeTabFromList=function(t){const e=[...document.querySelectorAll(".tab-row")].find(e=>parseInt(e.dataset.tabId)===parseInt(t)),n=e.parentElement;if(n){n.removeChild(e),[...n.children].some(t=>t.classList.contains("tab-row"))||document.querySelector(".tab-list").removeChild(n)}else document.querySelector(".tab-list").removeChild(e)},App.prototype.toggleMuteIcon=function(t,e){const n=[...document.querySelectorAll(".tab-row")].find(e=>parseInt(e.dataset.tabId)===parseInt(t)).children[1];n.children[0].children[0].style.display=e?"none":"block",n.children[0].children[1].style.display=e?"block":"none"},App.prototype.filterTabs=function(t){const e=t.target.value,n=this.listOfTabs.map(t=>{const n=t.tabs.filter(t=>t.title.indexOf(e)>-1||t.url.indexOf(e)>-1);return Object.assign({},t,{tabs:n})});this.displayFilteredList(n)},App.prototype.init=async function(){this.registerEvents(),await this.getTabsList(),this.displayList({tabsList:this.listOfTabs})},App.prototype.displayFilteredList=function(t){document.querySelector(".tab-list").innerHTML="",this.displayList({tabsList:t})};