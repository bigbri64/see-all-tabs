(function(){function t(){this.currentWindowId=null,this.windowCounter=0,this.listOfTabs=[]}let e;window.addEventListener("DOMContentLoaded",function(){e=new t,e.init()}),window.addEventListener("unload",function(){e.unregisterAndCleanUp()}),t.prototype.getTabsList=function(){return new Promise((t,e)=>{chrome.windows.getAll({populate:!0},e=>{this.listOfTabs=[...e],t()})})},t.prototype.displayList=function({tabsList:t}){const e=document.querySelector(".tab-list");t.forEach((n,o)=>{const i=document.createDocumentFragment();if(n.tabs.forEach(t=>{i.appendChild(this.buildTabRow({tab:t}))}),t.length>1&&n.tabs.length>0){const t=this.buildGroup({chromeWindow:n,tabRowFragment:i,windowIndex:o+1});e.appendChild(t)}else e.appendChild(i)})},t.prototype.buildGroup=function({chromeWindow:t,tabRowFragment:e,windowIndex:n}){const o=document.createElement("div");o.className="group";const i=document.createElement("div");return i.className="group-title",currentWindowId=t.tabs.length>0?t.tabs[0].windowId:n,i.innerText=`window ${n}`,o.className="group",o.dataset.groupId=currentWindowId,t.tabs.length>0&&o.appendChild(i),o.appendChild(e),o},t.prototype.buildTabRow=function({tab:t}){const e=t.active?"active":"",n=t.audible?"":"hidden";let o="display: none",i="display:none";t.audible&&(o=t.mutedInfo.muted?"display:none":"display:block",i=t.mutedInfo.muted?"display:block":"display:none");const s=document.createElement("div");s.className=`tab-row ${e}`,s.dataset.tabId=t.id,s.dataset.windowId=t.windowId;const a=document.createElement("div");a.className="favicon";const d=document.createElement("img");d.src=t.favIconUrl,a.appendChild(d),s.appendChild(a);const r=document.createElement("div");r.className="tab-title";const c=document.createElement("span");c.className=`speaker ${n}`;const l=document.createElement("img");l.src="../images/icons8-Speaker-16.png",l.alt="tab is playing",l.dataset.type="speaker",l.style=o,c.append(l);const u=document.createElement("img");u.src="../images/icons8-No Audio-16.png",u.alt="tab is muted",u.dataset.type="speaker",u.style=i,c.append(l),c.append(u),r.appendChild(c);const p=document.createElement("span");p.className="tab-desc",p.innerText=t.title,r.appendChild(p),s.appendChild(r);const m=document.createElement("div");m.className="close-button",m.dataset.type="closeButton";const b=document.createElement("img");return b.src="./images/svg/times-circle.svg",b.dataset.type="closeButton",m.appendChild(b),s.appendChild(m),s},t.prototype.clearFilter=function(){document.querySelector(".filterBox").value="",document.querySelector(".tab-list").innerHTML="",this.displayList({tabsList:this.listOfTabs})},t.prototype.registerEvents=function(){document.querySelector(".tab-list").addEventListener("click",this.onTabListClick.bind(e)),document.querySelector(".tab-list").addEventListener("mousedown",this.onMouseDown.bind(e)),document.querySelector(".filterBox").addEventListener("keyup",this.filterTabs.bind(e)),document.querySelector(".remove-filter").addEventListener("click",this.clearFilter.bind(e))},t.prototype.onMouseDown=function(t){const e=2===t.which;if(e){const{tabId:e,windowId:n}=this.getTabData(t);this.removeTabFromList(e),this.closeTab(e)}},t.prototype.onTabListClick=function(t){const{tabId:e,windowId:n}=this.getTabData(t),o=t.target.tagName.toLowerCase(),i=t.target.dataset.type;"img"!==o||"speaker"!==i?"img"!==o&&"div"!==o||"closeButton"!==i?this.setActiveTab({tabId:e,windowId:n}):(this.removeTabFromList(e),this.closeTab(e)):this.toggleMute(e)},t.prototype.toggleMute=function(t){chrome.tabs.get(t,e=>{const n=!e.mutedInfo.muted;chrome.tabs.update(t,{muted:n}),console.log("this",this),this.toggleMuteIcon(t,n)})},t.prototype.setActiveTab=function({tabId:t,windowId:e}){chrome.windows.update(e,{focused:!0},function(){this.selectedWindowId=e}),chrome.tabs.update(t,{active:!0})},t.prototype.unregisterAndCleanUp=function(){document.querySelector(".tab-list").removeEventListener("click",this.onTabListClick),document.querySelector(".filterBox").removeEventListener("keyup",this.filterTabs),document.querySelector(".remove-filter").removeEventListener("click",this.clearFilter)},t.prototype.getTabData=function(t){let e=t.target,n=e.tagName.toLowerCase();for(;"div"!==n||"div"===n&&!e.classList.contains("tab-row");)e=e.parentNode,n=e.tagName.toLowerCase();return{tabId:parseInt(e.dataset.tabId),windowId:parseInt(e.dataset.windowId)}},t.prototype.closeTab=function(t){chrome.tabs.remove(t)},t.prototype.removeTabFromList=function(t){const e=[...document.querySelectorAll(".tab-row")],n=e.find(e=>parseInt(e.dataset.tabId)===parseInt(t)),o=n.parentElement;if(o){o.removeChild(n);const t=[...o.children],e=t.some(t=>t.classList.contains("tab-row"));e||document.querySelector(".tab-list").removeChild(o)}else document.querySelector(".tab-list").removeChild(n)},t.prototype.toggleMuteIcon=function(t,e){const n=[...document.querySelectorAll(".tab-row")],o=n.find(e=>parseInt(e.dataset.tabId)===parseInt(t)),i=o.children[1];i.children[0].children[0].style.display=e?"none":"block",i.children[0].children[1].style.display=e?"block":"none"},t.prototype.filterTabs=function(t){const e=t.target.value,n=this.listOfTabs.map(t=>{const n=t.tabs.filter(t=>t.title.indexOf(e)>-1||t.url.indexOf(e)>-1);return Object.assign({},t,{tabs:n})});this.displayFilteredList(n)},t.prototype.init=async function(){this.registerEvents(),await this.getTabsList(),this.displayList({tabsList:this.listOfTabs})},t.prototype.displayFilteredList=function(t){const e=document.querySelector(".tab-list");e.innerHTML="",this.displayList({tabsList:t})}})();